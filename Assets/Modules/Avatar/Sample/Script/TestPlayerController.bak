using com.playbux.utilis.math;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Zenject;

namespace com.playbux.avatar.test
{
    public class TestPlayerController : MonoBehaviour
    {
        private IAvatarBoard board;
        private string id;
        [Inject]
        public void Setup(string id, IAvatarBoard board)
        {
            this.board = board;
            this.id = id;
        }



        // Start is called before the first frame update
        void Start()
        {

        }






        // Update is called once per frame
        void Update()
        {

            int dir = 0;
            Vector2 direction = new Vector2(0, 0);
            if (Input.GetKey(KeyCode.A))
            {
                direction.x = -1;
            }

            if (Input.GetKey(KeyCode.D))
            {
                direction.x = 1;
            }

            if (Input.GetKey(KeyCode.S))
            {
                direction.y = 1;
            }

            if (Input.GetKey(KeyCode.W))
            {
                direction.y = -1;

            }

            var speed = 15f;
            if (direction.x == 0 & direction.y != 0)
            {
                speed *= 1.66f;
            }

            direction.Rotate(45);
            direction.Normalize();
            var pos = transform.position;
            pos.x += direction.y * speed * Time.deltaTime;
            pos.z += direction.x * speed * Time.deltaTime;
            transform.position = pos;

            float angle = Mathf.Atan2(direction.y, direction.x) * Mathf.Rad2Deg;
            if (angle >= 45f && angle <= 135f)
            {
                dir = 1;
            }
            else if (angle > 135f || angle < -135f)
            {
                dir = 0;
            }
            else if (angle < 45f && angle > -45f)
            {
                dir = 2;
            }
            else
            {
                dir = 3;
            }
            if (direction.magnitude != 0)
            {
                board.UpdateAvatarDirection(this.id, dir);
            }
            if (Input.GetKey(KeyCode.A) || Input.GetKey(KeyCode.D) || Input.GetKey(KeyCode.S) || Input.GetKey(KeyCode.W))
            {
                board.UpdateAvatarAnimation(this.id, new AnimationInfo(ClipName.Walk, 3f, PlayAction.Loop));
            }
            else
            {
                board.UpdateAvatarAnimation(this.id, new AnimationInfo(ClipName.Idle, 1f, PlayAction.Loop));
            }


            if (Input.GetKey(KeyCode.Space))
            {
                board.UpdateAvatarAnimation(this.id, new AnimationInfo(ClipName.Walk, 3f, PlayAction.Pause));
            }
        }
    }
}
